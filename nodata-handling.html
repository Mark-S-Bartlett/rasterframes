<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="RasterFrames brings the power of Spark DataFrames to geospatial raster data.">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="RasterFrames brings the power of Spark DataFrames to geospatial raster data.">
<link rel="shortcut icon" href="assets/images/RasterFrames_32x32.ico">
<title>NoData Handling Â· RasterFrames</title>
<link rel="stylesheet" href="assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="assets/stylesheets/application-palette.22915126.css">
<meta name="theme-color" content="#546e7a" />
<link rel="stylesheet" href="lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="lib/prettify/prettify.css">
<script src="assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="assets/fonts/font-awesome.css">
<link rel="stylesheet" href="assets/fonts/material-icons.css">
<link rel="stylesheet" href="assets/stylesheets/paradox-material-theme.css">
<link rel="stylesheet" href="assets/custom.css">
</head>
<body
data-md-color-primary="blue-grey"
data-md-color-accent="light-blue"
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="index.html" title="RasterFrames" class="md-header-nav__button md-logo">
<img src="assets/images/RF-R.svg" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
RasterFrames
</span>
<span class="md-header-nav__topic">
NoData Handling
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/locationtech/rasterframes"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
locationtech/rasterframes
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="index.html" title="RasterFrames" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="assets/images/RF-R.svg" width="24" height="24">
</a>
<a href="index.html" title="RasterFrames">
RasterFrames
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/locationtech/rasterframes"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
locationtech/rasterframes
</div>
</a>

</div>
<ul>
  <li><a href="description.html" class="page">Overview</a></li>
  <li><a href="getting-started.html" class="page">Getting Started</a></li>
  <li><a href="concepts.html" class="page">Concepts</a></li>
  <li><a href="raster-io.html" class="page">Raster Data I/O</a>
  <ul>
    <li><a href="raster-catalogs.html" class="page">Raster Catalogs</a></li>
    <li><a href="raster-read.html" class="page">Reading Raster Data</a></li>
    <li><a href="raster-write.html" class="page">Writing Raster Data</a></li>
  </ul></li>
  <li><a href="vector-data.html" class="page">Vector Data</a></li>
  <li><a href="raster-processing.html" class="page">Raster Processing</a>
  <ul>
    <li><a href="local-algebra.html" class="page">Local Map Algebra</a></li>
    <li><a href="nodata-handling.html" class="active page">&ldquo;NoData&rdquo; Handling</a></li>
    <li><a href="masking.html" class="page">Masking</a></li>
    <li><a href="zonal-algebra.html" class="page">Zonal Map Algebra</a></li>
    <li><a href="aggregation.html" class="page">Aggregation</a></li>
    <li><a href="time-series.html" class="page">Time Series</a></li>
    <li><a href="raster-join.html" class="page">Raster Join</a></li>
    <li><a href="machine-learning.html" class="page">Machine Learning</a></li>
  </ul></li>
  <li><a href="numpy-pandas.html" class="page">NumPy and Pandas</a></li>
  <li><a href="languages.html" class="page">Scala and SQL</a></li>
  <li><a href="reference.html" class="page">Function Reference</a></li>
  <li><a href="release-notes.html" class="page">Release Notes</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="nodata-handling.html#handling" class="header">&ldquo;NoData&rdquo; Handling</a>
  <ul>
    <li><a href="nodata-handling.html#what-is-nodata-" class="header">What is NoData?</a></li>
    <li><a href="nodata-handling.html#cell-types" class="header">Cell Types</a></li>
    <li><a href="nodata-handling.html#nodata-and-local-arithmetic" class="header">NoData and Local Arithmetic</a></li>
    <li><a href="nodata-handling.html#changing-a-tiles-nodata-values" class="header">Changing a Tile&rsquo;s NoData Values</a></li>
    <li><a href="nodata-handling.html#combining-tiles-with-different-data-types" class="header">Combining Tiles with Different Data Types</a></li>
    <li><a href="nodata-handling.html#nodata-values-in-aggregation" class="header">NoData Values in Aggregation</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.9.0
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="nodata-handling.html#handling" class="header">&ldquo;NoData&rdquo; Handling</a>
  <ul>
    <li><a href="nodata-handling.html#what-is-nodata-" class="header">What is NoData?</a></li>
    <li><a href="nodata-handling.html#cell-types" class="header">Cell Types</a></li>
    <li><a href="nodata-handling.html#nodata-and-local-arithmetic" class="header">NoData and Local Arithmetic</a></li>
    <li><a href="nodata-handling.html#changing-a-tiles-nodata-values" class="header">Changing a Tile&rsquo;s NoData Values</a></li>
    <li><a href="nodata-handling.html#combining-tiles-with-different-data-types" class="header">Combining Tiles with Different Data Types</a></li>
    <li><a href="nodata-handling.html#nodata-values-in-aggregation" class="header">NoData Values in Aggregation</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#handling" name="handling" class="anchor"><span class="anchor-link"></span></a>&ldquo;NoData&rdquo; Handling</h1>
<h2><a href="#what-is-nodata-" name="what-is-nodata-" class="anchor"><span class="anchor-link"></span></a>What is NoData?</h2>
<p>In raster operations, the preservation and correct processing of missing observations is very important. In <a href="https://www.oreilly.com/learning/handling-missing-data">most DataFrames and in scientific computing</a>, the idea of missing data is expressed as a <code>null</code> or <code>NaN</code> value. However, a great deal of raster data is stored for space efficiency, which typically leads to use of integral values with a <a href="https://en.wikipedia.org/wiki/Sentinel_value">&ldquo;sentinel&rdquo; value</a> designated to represent missing observations. This sentinel value varies across data products and bands. In a generic sense, it is usually called the &ldquo;NoData&rdquo; value.</p>
<p>RasterFrames provides a variety of functions to inspect and manage NoData within <em>tiles</em>.</p>
<h2><a href="#cell-types" name="cell-types" class="anchor"><span class="anchor-link"></span></a>Cell Types</h2>
<p>To understand how NoData is handled in RasterFrames, we first need to understand the different underlying types of data called cell types. RasterFrames cell types are GeoTrellis <code>CellType</code>s, so the <a href="https://geotrellis.readthedocs.io/en/latest/guide/core-concepts.html?#working-with-cell-values">GeoTrellis documentation</a> is a valuable resource on how these are defined.</p>
<p>The <code>CellType</code> class from the <code>rf_types</code> submodule allows us to create a representation of any valid cell type. There are convenience methods to create instances for a variety of basic types.</p>
<pre class="prettyprint"><code class="language-python">from pyrasterframes.rf_types import CellType
CellType.bool()
CellType.int8()
CellType.uint8()
CellType.int16()
CellType.uint16()
CellType.int32()
CellType.float32()
CellType.float64()
</code></pre>
<p>We can also inspect the cell type of a given <em>tile</em> or <code>proj_raster</code> column.</p>
<pre class="prettyprint"><code class="language-python">cell_types = spark.read.raster(&#39;https://s22s-test-geotiffs.s3.amazonaws.com/luray_snp/B02.tif&#39;) \
    .select(rf_cell_type(&#39;proj_raster&#39;)).distinct()
cell_types
</code></pre>
<table>
  <thead>
    <tr>
      <th>rf_cell_type(proj_raster) </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>[uint16raw] </td>
    </tr>
  </tbody>
</table>
<h3><a href="#understanding-cell-types-and-nodata" name="understanding-cell-types-and-nodata" class="anchor"><span class="anchor-link"></span></a>Understanding Cell Types and NoData</h3>
<p>We can use the methods on the <code>CellType</code> class to learn more about a specific cell type. Let&rsquo;s consider the cell type of our sample data above.</p>
<pre class="prettyprint"><code class="language-python">ct = CellType(&#39;uint16raw&#39;)
ct, ct.is_floating_point(), ct.has_no_data()
</code></pre>
<pre><code>(uint16raw, False, False)
</code></pre>
<p>We can see that for the above data source, there is no defined NoData value. This means that each value is interpreted as a valid observation. Often such data is meant to be combined with another band indicating the quality of observations at each location. The lack of NoData is indicated by the <code>raw</code> at the end of the type name. Consider for contrast the <code>uint16</code> cell type.</p>
<pre class="prettyprint"><code class="language-python">from pyrasterframes.rf_types import CellType
ct = CellType(&#39;uint16&#39;)
ct, ct.is_floating_point(), ct.has_no_data(), ct.no_data_value()
</code></pre>
<pre><code>(uint16, False, True, 0)
</code></pre>
<p>In this case, the minimum value of 0 is designated as the NoData value. For integral-valued cell types, the NoData is typically zero, the maximum, or the minimum value for the underlying data type. The NoData value can also be a user-defined value. In that case the value is designated with <code>ud</code>.</p>
<pre class="prettyprint"><code class="language-python">CellType.uint16().with_no_data_value(99).cell_type_name
</code></pre>
<pre><code>&#39;uint16ud99&#39;
</code></pre>
<p>Floating point types have <code>NaN</code> as the NoData value by default. However, a user-defined NoData can be set.</p>
<pre class="prettyprint"><code class="language-python">print(CellType.float32().no_data_value())
print(CellType.float32().with_no_data_value(-99.9).no_data_value())
</code></pre>
<pre><code>nan
-99.9
</code></pre>
<h2><a href="#nodata-and-local-arithmetic" name="nodata-and-local-arithmetic" class="anchor"><span class="anchor-link"></span></a>NoData and Local Arithmetic</h2>
<p>Let&rsquo;s now explore how the presence of NoData affects <a href="local-algebra.html">local map algebra</a> operations. To demonstrate the behavior, lets create two <em>tiles</em>. One <em>tile</em> will have values of 0 and 1, and the other will have values of just 0.</p>
<pre class="prettyprint"><code class="language-python">tile_size = 100
x = np.zeros((tile_size, tile_size), dtype=&#39;int16&#39;)
x[:,tile_size//2:] = 1
x = Tile(x)
y = Tile(np.zeros((tile_size, tile_size), dtype=&#39;int16&#39;))

rf = spark.createDataFrame([Row(x=x, y=y)])
print(&#39;x&#39;)
display(x)
</code></pre>
<pre><code>x
</code></pre>
<p><img src="figures/nodata-handling_local_arith_1.png" /></p>
<pre class="prettyprint"><code class="language-python">print(&#39;y&#39;)
display(y)
</code></pre>
<pre><code>y
/anaconda3/envs/rf-docs/lib/python3.7/site-packages/matplotlib/image.py:405: UserWarning: Warning: converting a masked element to nan.
  dv = (np.float64(self.norm.vmax) -
/anaconda3/envs/rf-docs/lib/python3.7/site-packages/matplotlib/image.py:406: UserWarning: Warning: converting a masked element to nan.
  np.float64(self.norm.vmin))
/anaconda3/envs/rf-docs/lib/python3.7/site-packages/matplotlib/image.py:413: UserWarning: Warning: converting a masked element to nan.
  a_min = np.float64(newmin)
/anaconda3/envs/rf-docs/lib/python3.7/site-packages/matplotlib/image.py:418: UserWarning: Warning: converting a masked element to nan.
  a_max = np.float64(newmax)
&lt;string&gt;:6: UserWarning: Warning: converting a masked element to nan.
/anaconda3/envs/rf-docs/lib/python3.7/site-packages/numpy/ma/core.py:722: UserWarning: Warning: converting a masked element to nan.
  data = np.array(a, copy=False, subok=subok)
</code></pre>
<p><img src="figures/nodata-handling_display_1_1.png" /></p>
<p>Now, let&rsquo;s create a new column from <code>x</code> with the value of 1 changed to NoData. Then, we will add this new column with NoData to the <code>y</code> column. As shown below, the result of the sum also has NoData (represented in white). In general for local algebra operations, Data + NoData = NoData.</p>
<pre class="prettyprint"><code class="language-python">masked_rf = rf.withColumn(&#39;x_nd&#39;, rf_mask_by_value(&#39;x&#39;, &#39;x&#39;, lit(1)) )
masked_rf = masked_rf.withColumn(&#39;x_nd_y_sum&#39;, rf_local_add(&#39;x_nd&#39;, &#39;y&#39;))
row = masked_rf.collect()[0]
print(&#39;x with NoData&#39;)
display(row.x_nd)
</code></pre>
<pre><code>x with NoData
</code></pre>
<p><img src="figures/nodata-handling_display_2_1.png" /></p>
<pre class="prettyprint"><code class="language-python">print(&#39;x with NoData plus y&#39;)
display(row.x_nd_y_sum)
</code></pre>
<pre><code>x with NoData plus y
</code></pre>
<p><img src="figures/nodata-handling_display_3_1.png" /> To see more information about possible operations on <em>tile</em> columns, see the <a href="local-algebra.html">local map algebra</a> page and <a href="reference.html#local-map-algebra">function reference</a>.</p>
<h2><a href="#changing-a-tiles-nodata-values" name="changing-a-tiles-nodata-values" class="anchor"><span class="anchor-link"></span></a>Changing a Tile&rsquo;s NoData Values</h2>
<p>One way to mask a <em>tile</em> is to make a new <em>tile</em> with a user defined NoData value. We will explore this method below. First, lets create a DataFrame from a <em>tile</em> with values of 0, 1, 2, and 3. We will use numpy to create a 100x100 <em>tile</em> with vertical bands containing values 0, 1, 2, and 3.</p>
<pre class="prettyprint"><code class="language-python">tile_size = 100
x = np.zeros((tile_size, tile_size), dtype=&#39;int16&#39;)

# setting the values of the columns
for i in range(4):
    x[:, i*tile_size//4:(i+1)*tile_size//4] = i
x = Tile(x)

rf = spark.createDataFrame([Row(tile=x)])
display(x)
</code></pre>
<p><img src="figures/nodata-handling_create_dummy_tile_1.png" alt="Dummy Tile" /></p>
<p>First, we mask the value of 1 by making a new <em>tile</em> column with the user defined cell type &lsquo;uint16ud1&rsquo;. Then, we mask out the value of two by making a <em>tile</em> column with the cell type &lsquo;uint16ud2&rsquo;.</p>
<pre class="prettyprint"><code class="language-python">def get_nodata_ct(nd_val):
	return CellType(&#39;uint16&#39;).with_no_data_value(nd_val)

masked_rf = rf.withColumn(&#39;tile_nd_1&#39;,
                           rf_convert_cell_type(&#39;tile&#39;, get_nodata_ct(1))) \
              .withColumn(&#39;tile_nd_2&#39;,
                          rf_convert_cell_type(&#39;tile_nd_1&#39;, get_nodata_ct(2))) \
</code></pre>
<pre class="prettyprint"><code class="language-python">collected = masked_rf.collect()
</code></pre>
<p>Let&rsquo;s look at the new <em>tiles</em> we created. The <em>tile</em> named <code>tile_nd_1</code> has the 1 values masked out as expected.</p>
<pre class="prettyprint"><code class="language-python">display(collected[0].tile_nd_1)
</code></pre>
<p><img src="figures/nodata-handling_display_4_1.png" /></p>
<p>And the <em>tile</em> named <code>tile_nd_2</code> has the values of 1 and 2 masked out. This is because we created the <em>tile</em> by setting a new user defined NoData value to <code>tile_nd_1</code>, and the values previously masked out in <code>tile_nd_1</code> stayed masked when creating <code>tile_nd_2</code>.</p>
<pre class="prettyprint"><code class="language-python">display(collected[0].tile_nd_2)
</code></pre>
<p><img src="figures/nodata-handling_display_5_1.png" /></p>
<h2><a href="#combining-tiles-with-different-data-types" name="combining-tiles-with-different-data-types" class="anchor"><span class="anchor-link"></span></a>Combining Tiles with Different Data Types</h2>
<p>RasterFrames supports having <em>tile</em> columns with different cell types in a single DataFrame. It is important to understand how these different cell types interact.</p>
<p>Let&rsquo;s first create a RasterFrame that has columns of <code>float</code> and <code>int</code> cell type.</p>
<pre class="prettyprint"><code class="language-python">x = Tile((np.ones((100, 100))*2), CellType.float64())
y = Tile((np.ones((100, 100))*3), CellType.int32())
rf = spark.createDataFrame([Row(x=x, y=y)])

cell_types = rf.select(rf_cell_type(&#39;x&#39;), rf_cell_type(&#39;y&#39;)).distinct()
cell_types
</code></pre>
<table>
  <thead>
    <tr>
      <th>rf_cell_type(x) </th>
      <th>rf_cell_type(y) </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>[float64] </td>
      <td>[int32] </td>
    </tr>
  </tbody>
</table>
<p>When performing a local operation between <em>tile</em> columns with cell types <code>int</code> and <code>float</code>, the resulting <em>tile</em> cell type will be <code>float</code>. In local algebra over two <em>tiles</em> of different &ldquo;sized&rdquo; cell types, the resulting cell type will be the larger of the two input <em>tiles&rsquo;</em> cell types.</p>
<pre class="prettyprint"><code class="language-python">sums = rf.select(
    rf_cell_type(&#39;x&#39;),
    rf_cell_type(&#39;y&#39;),
    rf_cell_type(rf_local_add(&#39;x&#39;, &#39;y&#39;)).alias(&#39;xy_sum&#39;),
    )
sums
</code></pre>
<table>
  <thead>
    <tr>
      <th>rf_cell_type(x) </th>
      <th>rf_cell_type(y) </th>
      <th>xy_sum </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>[float64] </td>
      <td>[int32] </td>
      <td>[float64] </td>
    </tr>
  </tbody>
</table>
<p>Combining <em>tile</em> columns of different cell types gets a little trickier when user defined NoData cell types are involved. Let&rsquo;s create two <em>tile</em> columns: one with a NoData value of 1, and one with a NoData value of 2 (using our previously defined <code>get_nodata_ct</code> function).</p>
<pre class="prettyprint"><code class="language-python">x_nd_1 = Tile((np.ones((100, 100))*3), get_nodata_ct(1))
x_nd_2 = Tile((np.ones((100, 100))*3), get_nodata_ct(2))
rf_nd = spark.createDataFrame([Row(x_nd_1=x_nd_1, x_nd_2=x_nd_2)])
</code></pre>
<p>Let&rsquo;s try adding the <em>tile</em> columns with different NoData values. When there is an inconsistent NoData value in the two columns, the NoData value of the right-hand side of the sum is kept. In this case, this means the result has a NoData value of 1.</p>
<pre class="prettyprint"><code class="language-python">rf_nd_sum = rf_nd.withColumn(&#39;x_nd_sum&#39;, rf_local_add(&#39;x_nd_2&#39;, &#39;x_nd_1&#39;))
cell_types = rf_nd_sum.select(rf_cell_type(&#39;x_nd_sum&#39;)).distinct()
cell_types
</code></pre>
<table>
  <thead>
    <tr>
      <th>rf_cell_type(x_nd_sum) </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>[uint16ud2] </td>
    </tr>
  </tbody>
</table>
<p>Reversing the order of the sum changes the NoData value of the resulting column to 2.</p>
<pre class="prettyprint"><code class="language-python">rf_nd_sum = rf_nd.withColumn(&#39;x_nd_sum&#39;, rf_local_add(&#39;x_nd_1&#39;, &#39;x_nd_2&#39;))
cell_types = rf_nd_sum.select(rf_cell_type(&#39;x_nd_sum&#39;)).distinct()
cell_types
</code></pre>
<table>
  <thead>
    <tr>
      <th>rf_cell_type(x_nd_sum) </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>[uint16ud1] </td>
    </tr>
  </tbody>
</table>
<h2><a href="#nodata-values-in-aggregation" name="nodata-values-in-aggregation" class="anchor"><span class="anchor-link"></span></a>NoData Values in Aggregation</h2>
<p>Let&rsquo;s use the same <em>tile</em> as before to demonstrate how NoData values affect <em>tile</em> aggregations.</p>
<pre class="prettyprint"><code class="language-python">tile_size = 100
x = np.zeros((tile_size, tile_size))
for i in range(4):
    x[:, i*tile_size//4:(i+1)*tile_size//4] = i
x = Tile(x, CellType.int16())

rf = spark.createDataFrame([Row(tile=x)])
display(x)
</code></pre>
<p><img src="figures/nodata-handling_display_6_1.png" /></p>
<p>First we create the two new masked <em>tile</em> columns as before. One with only the value of 1 masked, and the other with and values of 1 and 2 masked.</p>
<pre class="prettyprint"><code class="language-python">masked_rf = rf.withColumn(&#39;tile_nd_1&#39;,
                           rf_convert_cell_type(&#39;tile&#39;, get_nodata_ct(1))) \
              .withColumn(&#39;tile_nd_2&#39;,
                          rf_convert_cell_type(&#39;tile_nd_1&#39;, get_nodata_ct(2)))
</code></pre>
<p>The results of <code>rf_tile_sum</code> vary on the <em>tiles</em> that were masked. This is because any cells with NoData values are ignored in the aggregation. Note that <code>tile_nd_2</code> has the lowest sum, since it has the fewest amount of data cells.</p>
<pre class="prettyprint"><code class="language-python">sums = masked_rf.select(rf_tile_sum(&#39;tile&#39;), rf_tile_sum(&#39;tile_nd_1&#39;), rf_tile_sum(&#39;tile_nd_2&#39;))
sums
</code></pre>
<table>
  <thead>
    <tr>
      <th>rf_tile_sum(tile) </th>
      <th>rf_tile_sum(tile_nd_1) </th>
      <th>rf_tile_sum(tile_nd_2) </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>15000.0 </td>
      <td>12500.0 </td>
      <td>7500.0 </td>
    </tr>
  </tbody>
</table>
</div>
<div>
<a href="https://github.com/locationtech/rasterframes/tree/v0.9.0/pyrasterframes/target/python/docs/nodata-handling.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.9.0
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="local-algebra.html" title="Local Map Algebra" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Local Map Algebra
</span>
</div>
</a>
<a href="masking.html" title="Masking" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Masking
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
&copy; 2017-2019 <a href="https://astraea.earth">Astraea</a>, Inc. All rights reserved.
</div>
</div>
</div>
</div>
</footer>

</div>
<script src="assets/javascripts/application.583bbe55.js"></script>
<script src="assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"."}})</script>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-106630615-1"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})});if(document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>

</body>
</html>
